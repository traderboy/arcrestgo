<!DOCTYPE HTML>
<html>

<head>
    <title>ArcService JSON Editor</title>

    <link href="dist/jsoneditor.css" rel="stylesheet" type="text/css">
    <script src="dist/jsoneditor.js"></script>
    <script>
        function populateDropdown() {
            var select = document.getElementById("urls")
            var pre = location.host
            var langArray = [            
            { "value": "", "text": "" },
            { "value": "config", "text": "Configuration" },
            { "value": "sharing/{rest}/accounts/self", "text": "Accounts self" },
            //{ "value": "/sharing/rest/portals/self", "text": "Portals self" },
            { "value": "sharing/rest/search", "text": "Search" },
            { "value": "sharing/rest/content/items/leasecompliancefor2016", "text": "Content items" },
            { "value": "sharing/rest/content/items/leasecompliancefor2016/data", "text": "Content items data" },
            { "value": "arcgis/rest/services/leasecompliancefor2016/FeatureServer", "text": "FeatureServer" },
            { "value": "arcgis/rest/services/leasecompliancefor2016/FeatureServer/0", "text": "FeatureServer 0" },
            { "value": "arcgis/rest/services/leasecompliancefor2016/FeatureServer/1", "text": "FeatureServer 1" },
            { "value": "arcgis/rest/services/leasecompliancefor2016/FeatureServer/2", "text": "FeatureServer 2" },
            { "value": "arcgis/rest/services/leasecompliancefor2016/FeatureServer/3", "text": "FeatureServer 3" },
            { "value": "arcgis/rest/services/leasecompliancefor2016/FeatureServer/4", "text": "FeatureServer 4" },
            { "value": "arcgis/rest/services/leasecompliancefor2016/FeatureServer/5", "text": "FeatureServer 5" },
            { "value": "arcgis/rest/services/leasecompliancefor2016/FeatureServer/6", "text": "FeatureServer 6" }
            ]
            var il = langArray.length;
            var i = 0;
            var option;
            for (; i < il; i += 1) {
                option = document.createElement('option');
                option.setAttribute('value', langArray[i].value);
                option.appendChild(document.createTextNode(langArray[i].text));
                select.appendChild(option);
            }
        }
        function updateURL(sel) {
            var val = location.href + sel.value
            var url = document.getElementById("url").value = val
            loadURL()
        }
        function loadURL() {
            var url = document.getElementById("url").value
            if (url == "") {
                document.getElementById('urlLbl').innerHTML = "<b style='color:red'>Enter a valid URL</b>"
                return
            }
            document.getElementById('urlLbl').innerHTML = ""

            loadJSON(url,
                function (data) {
                    console.log(data);
                    //json = JSON.parse(data)
                    //alert(json)
                    editor.set(data);

                },
                function (xhr) {
                    console.error(xhr);
                    document.getElementById('urlLbl').innerHTML = "<b style='color:red'>URL not found</b>"
                    editor.set({});
                }
            );
        }

        function loadJSON(path, success, error) {
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function () {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                        if (success)
                            success(JSON.parse(xhr.responseText));
                    } else {
                        if (error)
                            error(xhr);
                    }
                }
            };
            xhr.open("GET", path, true);
            xhr.send();
        }
        function putJSON(url, txt, success, error) {
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function () {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                        if (success)
                            success(JSON.parse(xhr.responseText));
                    } else {
                        if (error)
                            error(xhr);
                    }
                }
            };

            xhr.open('PUT', url, true);//true: asynchronous, false: synchronous
            //xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            /*
            xhr.onload = function () {
                if (xhr.status === 200) {
                    if (success)
                        success(JSON.parse(xhr.responseText));
                } else {
                    if (error)
                        error(xhr);
                }
            };
            */
            //xhr.send(encodeURI(txt));
            xhr.send(txt);

        }   
    </script>

<style type="text/css">
    #jsoneditor {
      width: 100%;
      height: 1500px;
    }
  </style>
</head>

<body onload="populateDropdown()">

<div>
    <form id='loader' name='loader' style='display:inline'>
<input type='submit' id="setJSON" value='URL'></input>
<input id='url' type='text' style='width:50%'>
</form>

<form id='urlfrm' style='display:inline'>
<select id="urls" onchange="updateURL(this)">
</select>
</form>

<form id='frm' method="POST" action="/update" style='float:right;display:inline'>
<input type='submit' style='float:right' id="getJSON" value='Save JSON'></input>
<input type='hidden' id='updatestr' name='update' value=''>
<input type='hidden' id='urlstr' name='url' value=''>
</form>

<span id="urlLbl"></span>
</div>


<div id="jsoneditor"></div>

<script>
                            // create the editor
                            var container = document.getElementById('jsoneditor');
                            var options = {};
                            var editor = new JSONEditor(container, options);

                            // set json
                            document.getElementById('loader').onsubmit = function () {
                                loadURL()
                                return false
                            };

                            // get json
                            document.getElementById('frm').onsubmit = function () {
                                var json = editor.get();
                                //var input_el = document.getElementById("updatestr")
                                //input_el.value = JSON.stringify(json)
                                var url = document.getElementById("url").value
                                //var url_el = document.getElementById("urlstr")
                                //url_el.value = url
                                putJSON(url, JSON.stringify(json),
                                    function (data) {
                                        document.getElementById('urlLbl').innerHTML = "<b style='color:green'>Success</b>"
                                    },
                                    function (xhr) {
                                        console.error(xhr);
                                        document.getElementById('urlLbl').innerHTML = "<b style='color:red'>Error saving JSON</b>"
                                    }
                                )

                                return false


                                //alert(JSON.stringify(json, null, 2));

                            };
</script>
</body>

</html>